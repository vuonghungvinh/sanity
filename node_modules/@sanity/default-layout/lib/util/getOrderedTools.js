'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = getOrderedTools;

var _defaultLayout = require('config:@sanity/default-layout');

var _defaultLayout2 = _interopRequireDefault(_defaultLayout);

var _tool = require('all:part:@sanity/base/tool');

var _tool2 = _interopRequireDefault(_tool);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function getOrderedTools() {
  var config = _defaultLayout2.default.toolSwitcher || {};
  var order = config.order || [];
  var hidden = config.hidden || [];

  if (!order.length && !hidden.length) {
    return _tool2.default;
  }

  var keyed = _tool2.default.reduce(function (target, tool) {
    var title = tool.title || '<unknown>';

    if (!tool.name) {
      console.warn('Tool "' + title + '" does not have the required "name"-property'); // eslint-disable-line no-console
      return target;
    }

    if (target[tool.name]) {
      var existing = target[tool.name].tool.title;
      console.warn('Tools with duplicate name "' + tool.name + '" found ("' + title + '" and "' + existing + '")'); // eslint-disable-line no-console
      return target;
    }

    var toolIndex = order.indexOf(tool.name);
    target[tool.name] = {
      tool: tool,
      index: toolIndex === -1 ? +Infinity : toolIndex
    };
    return target;
  }, {});

  var isVisible = function isVisible(tool) {
    return hidden.indexOf(tool.name) === -1;
  };

  return _tool2.default.filter(isVisible).sort(function (tool1, tool2) {
    var toolA = keyed[tool1.name];
    var toolB = keyed[tool2.name];

    var indexA = toolA ? toolA.index : +Infinity;
    var indexB = toolB ? toolB.index : +Infinity;

    if (indexA === indexB) {
      return 0;
    }

    return indexA - indexB;
  });
}