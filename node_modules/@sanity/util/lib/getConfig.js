'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _merge2 = require('lodash/merge');

var _merge3 = _interopRequireDefault(_merge2);

var _get2 = require('lodash/get');

var _get3 = _interopRequireDefault(_get2);

var _path = require('path');

var _path2 = _interopRequireDefault(_path);

var _safeJson = require('./safeJson');

var _reduceConfig = require('./reduceConfig');

var _reduceConfig2 = _interopRequireDefault(_reduceConfig);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

const defaults = {
  server: {
    staticPath: './static',
    port: 3333,
    hostname: 'localhost'
  }
};

const configContainer = values => ({
  get: (dotPath, defaultValue) => (0, _get3.default)(values, dotPath, defaultValue)
});

const getConfig = rootDir => {
  const localConfig = rootDir && (0, _safeJson.loadJsonSync)(_path2.default.join(rootDir, 'sanity.json'));
  const config = (0, _reduceConfig2.default)(localConfig ? (0, _merge3.default)({}, defaults, localConfig) : defaults, process.env.NODE_ENV || 'development' // eslint-disable-line no-process-env
  );

  return configContainer(config);
};

exports.default = getConfig;