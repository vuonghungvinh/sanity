'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.loadImage = loadImage;

var _minimal = require('@sanity/observable/minimal');

var _minimal2 = _interopRequireDefault(_minimal);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

// http://probablyprogramming.com/2009/03/15/the-tiniest-gif-ever
var PROBABLY_THE_TINIEST_GIF_EVER = 'data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=';
var noop = function noop() {};

function isLocalFile(src) {
  return src.startsWith('blob:');
}

function loadImage(src) {
  return new _minimal2.default(function (observer) {
    var image = document.createElement('img');
    var loaded = false;
    var onload = function onload() {
      loaded = true;
      observer.next(image);
      observer.complete();
    };
    var onerror = function onerror() {
      observer.error(new Error('Could not load image from ' + (isLocalFile(src) ? 'local file' : src)));
    };

    image.onload = onload;
    image.onerror = onerror;

    image.src = src;
    return function () {
      image.onload = image.onerror = noop;
      if (!loaded) {
        image.src = PROBABLY_THE_TINIEST_GIF_EVER;
      }
    };
  });
}