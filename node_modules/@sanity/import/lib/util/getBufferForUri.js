'use strict';

var getUri = require('@rexxars/get-uri');
var simpleConcat = require('simple-concat');

function getBufferForUri(uri) {
  return new Promise(function (resolve, reject) {
    getUri(uri, function (err, stream) {
      if (err) {
        reject(new Error(readError(uri, err)));
        return;
      }

      simpleConcat(stream, function (streamErr, buffer) {
        if (streamErr) {
          reject(new Error(readError(uri, streamErr)));
          return;
        }

        resolve(buffer);
      });
    });
  });
}

function readError(uri, err) {
  return `Error while fetching asset from "${uri}":\n${err.message}`;
}

module.exports = getBufferForUri;