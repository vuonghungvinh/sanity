{"version":3,"sources":["../../src/middleware/promise.js"],"names":["global","require","Cancel","CancelToken","isCancel","promise","Promise","Error","onReturn","channels","context","resolve","reject","cancel","options","cancelToken","then","reason","abort","publish","error","subscribe","response","setTimeout","request","module","exports"],"mappings":";;AAAA,MAAMA,SAASC,QAAQ,gBAAR,CAAf;AACA,MAAMC,SAASD,QAAQ,iBAAR,CAAf;AACA,MAAME,cAAcF,QAAQ,sBAAR,CAApB;AACA,MAAMG,WAAWH,QAAQ,mBAAR,CAAjB;;AAEA,MAAMI,UAAU,MAAM;AACpB,QAAMC,UAAUN,OAAOM,OAAvB;AACA,MAAI,CAACA,OAAL,EAAc;AACZ,UAAM,IAAIC,KAAJ,CAAU,8EAAV,CAAN;AACD;;AAED,SAAO;AACLC,cAAU,CAACC,QAAD,EAAWC,OAAX,KAAuB,IAAIJ,OAAJ,CAAY,CAACK,OAAD,EAAUC,MAAV,KAAqB;AAChE,YAAMC,SAASH,QAAQI,OAAR,CAAgBC,WAA/B;AACA,UAAIF,MAAJ,EAAY;AACVA,eAAOR,OAAP,CAAeW,IAAf,CAAoBC,UAAU;AAC5BR,mBAASS,KAAT,CAAeC,OAAf,CAAuBF,MAAvB;AACAL,iBAAOK,MAAP;AACD,SAHD;AAID;;AAEDR,eAASW,KAAT,CAAeC,SAAf,CAAyBT,MAAzB;AACAH,eAASa,QAAT,CAAkBD,SAAlB,CAA4BV,OAA5B;;AAEA;AACAY,iBAAW,MAAMd,SAASe,OAAT,CAAiBL,OAAjB,CAAyBT,OAAzB,CAAjB,EAAoD,CAApD;AACD,KAdgC;AAD5B,GAAP;AAiBD,CAvBD;;AAyBAL,QAAQH,MAAR,GAAiBA,MAAjB;AACAG,QAAQF,WAAR,GAAsBA,WAAtB;AACAE,QAAQD,QAAR,GAAmBA,QAAnB;;AAEAqB,OAAOC,OAAP,GAAiBrB,OAAjB","file":"promise.js","sourcesContent":["const global = require('../util/global')\nconst Cancel = require('./cancel/Cancel')\nconst CancelToken = require('./cancel/CancelToken')\nconst isCancel = require('./cancel/isCancel')\n\nconst promise = () => {\n  const Promise = global.Promise\n  if (!Promise) {\n    throw new Error('`Promise` is not available in global scope, and no implementation was passed')\n  }\n\n  return {\n    onReturn: (channels, context) => new Promise((resolve, reject) => {\n      const cancel = context.options.cancelToken\n      if (cancel) {\n        cancel.promise.then(reason => {\n          channels.abort.publish(reason)\n          reject(reason)\n        })\n      }\n\n      channels.error.subscribe(reject)\n      channels.response.subscribe(resolve)\n\n      // Wait until next tick in case cancel has been performed\n      setTimeout(() => channels.request.publish(context), 0)\n    })\n  }\n}\n\npromise.Cancel = Cancel\npromise.CancelToken = CancelToken\npromise.isCancel = isCancel\n\nmodule.exports = promise\n"]}